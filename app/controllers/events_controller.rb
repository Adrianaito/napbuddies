class EventsController < ApplicationController
  def new
    @event = Event.new
    authorize @event
  end

  def create
    @event = Event.new(event_params)
    @event.user = current_user
    authorize @event
    if @event.save
      redirect_to events_path
    else
      render 'new'
    end
  end

  def index
    @events = Event.all
    @events = policy_scope(@events)
    @markers = @events.geocoded.map do |event|
      {
        lat: event.latitude,
        lng: event.longitude,
        infoWindow: render_to_string(partial: "info_window", locals: { event: event }),
        image_url: helpers.asset_url('data:image/png;base64,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')
      }
    end
  end

  def show
    @event = Event.find(params[:id])
    @user = @event.user
    authorize @event
  end

  private

  def event_params
    params.require(:event).permit(:title, :location, :time, :max_guest, :host_spoon, :description, :photo)
  end
end
